/*
			Note : Authenticate Google Calendar connection by clicking Manage Connection Link at the bottom of the page
			*/
response = Map();
if(context_id.equals("schedule"))
{
	response.put("action","context");
	response.put("context_id","schedule");
	name = answers.get("name").get("text");
	if(!answers.containsKey("email"))
	{
		question = {"name":"email","replies":{"enter your email address?"}};
	}
	else
	{
		email = answers.get("email").get("text");
		if(!answers.containsKey("phone"))
		{
			question = {"name":"phone","replies":{"Can I have your contact number?"}};
		}
		else
		{
			phone = answers.get("phone").get("text");
        	meta = date.get("meta");
						card_data = meta.get("card_data");
						slot = card_data.get("value").get("slot");
						formattedDate = slot.toList("/");
						slot = formattedDate.get(1) + "/" + formattedDate.get(0) + "/" + formattedDate.get(2);
						value = slot.toDateTime();
						if(!answers.containsKey("thanks"))
						{
							/* Add  event to google calendar */
							_date = value.getYear().toString() + "-" + value.getMonth().toString() + "-" + value.getDay().toString() + "T" + value.getHour().toString() + ":" + value.getMinutes().toString() + ":" + value.getSeconds().toString();
							paramMap = {"start":{"dateTime":_date,"timeZone":"Asia/Kolkata"},"end":{"dateTime":_date,"timeZone":"Asia/Kolkata"},'summary':'Call with ' + name + '. Contact Number : ' + phone};
							apiresponse = invokeurl
							[
								url :"https://www.googleapis.com/calendar/v3/calendars/primary/events"
								type :POST
								parameters:paramMap.toString()
								headers:{'Content-type':'application/json;'}
								connection:"google_calendar"
							];
							info apiresponse;
							if(apiresponse.containsKey("status"))
							{
								status = apiresponse.get("status");
								if("confirmed".equalsIgnoreCase(status))
								{
									question = {"name":"thanks","replies":{"Thank you.","Your appointment has been scheduled with our Sales rep on " + slot}};
									response.put("questions",{question});
									return response;
								}
							}
							question = {"name":"thanks","replies":{"Sorry, please try later"}};
							response.put("questions",{question});
							return response;
			}
		}
	}
	response.put("questions",{question});
}
return response;
